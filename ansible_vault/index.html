



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://charlesreid1-docker.github.io/charlesreid1-ansible/ansible_vault/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="..">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-3.0.3">
    
    
      
        <title>Ansible Vault - charlesreid1-ansible</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#ansible-vault" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://charlesreid1-docker.github.io/charlesreid1-ansible" title="charlesreid1-ansible" class="md-header-nav__button md-logo">
          
            <i class="md-icon">dns</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                charlesreid1-ansible
              </span>
              <span class="md-header-nav__topic">
                Ansible Vault
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://git.charlesreid1.com/ansible/charlesreid1-ansible" title="Go to repository" class="md-source" data-md-source="">
    
    <div class="md-source__repository">
      charlesreid1-ansible
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://charlesreid1-docker.github.io/charlesreid1-ansible" title="charlesreid1-ansible" class="md-nav__button md-logo">
      
        <i class="md-icon">dns</i>
      
    </a>
    charlesreid1-ansible
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://git.charlesreid1.com/ansible/charlesreid1-ansible" title="Go to repository" class="md-source" data-md-source="">
    
    <div class="md-source__repository">
      charlesreid1-ansible
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Index" class="md-nav__link">
      Index
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../quickstart/" title="Quickstart" class="md-nav__link">
      Quickstart
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ansible_vagrant/" title="Ansible on Vagrant" class="md-nav__link">
      Ansible on Vagrant
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ansible_linode/" title="Ansible on Linode" class="md-nav__link">
      Ansible on Linode
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ansible_do/" title="Ansible on DigitalOcean" class="md-nav__link">
      Ansible on DigitalOcean
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ansible_playbooks/" title="Ansible Playbooks" class="md-nav__link">
      Ansible Playbooks
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Ansible Vault" class="md-nav__link md-nav__link--active">
      Ansible Vault
    </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ansible_cowsay/" title="Ansible Cowsay" class="md-nav__link">
      Ansible Cowsay
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="ansible-vault">Ansible Vault<a class="headerlink" href="#ansible-vault" title="Permanent link">&para;</a></h1>
<p>This page contains instructions for using the Ansible vault.</p>
<p>Link: <a href="https://docs.ansible.com/ansible/2.4/vault.html#creating-encrypted-files">Ansible vault documentation</a></p>
<h1 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="#what-is-ansible-vault">What is Ansible Vault?</a></li>
<li><a href="#where-is-the-vault-file">Where is the vault file?</a></li>
<li><a href="#how-to-view-the-vault-file">How to view the vault file?</a></li>
<li><a href="#how-to-create-a-vault-file">How to create a vault file?</a></li>
<li><a href="#how-to-edit-the-vault-file">How to edit the vault file?</a></li>
<li><a href="#how-to-use-the-vault-file">How to use the vault file?</a></li>
<li><a href="#adding-new-secret-variables">Adding new secret variables</a></li>
</ul>
<h2 id="what-is-ansible-vault">What is Ansible Vault?<a class="headerlink" href="#what-is-ansible-vault" title="Permanent link">&para;</a></h2>
<p>Ansible provides a "vault" function that allows sensitive data
(passwords, sensitive info, or certificate files) to be encrypted,
so it can be stored in a repository with the rest of the playbook.</p>
<p>The vault is an ordinary YAML file that defines variables, except
that the variables it defines are sensitive. These variables can
be used elsewhere in the playbook.</p>
<p>Ansible provides an <code>ansible-vault</code> command to interact with 
vault files.</p>
<h2 id="where-is-the-vault-file">Where is the vault file?<a class="headerlink" href="#where-is-the-vault-file" title="Permanent link">&para;</a></h2>
<p>There is currently one vault file that applies to all servers.
It is located in the repository at <code>group_vars/all/vault</code>.</p>
<h2 id="how-to-view-the-vault-file">How to view the vault file?<a class="headerlink" href="#how-to-view-the-vault-file" title="Permanent link">&para;</a></h2>
<p>To view the contents of the vault file, use the view action:</p>
<div class="codehilite"><pre><span></span>ansible-vault edit my_vault_file
</pre></div>


<h2 id="how-to-create-a-vault-file">How to create a vault file?<a class="headerlink" href="#how-to-create-a-vault-file" title="Permanent link">&para;</a></h2>
<p>No new vault files should be needed for this repository, but to create
a new vault file called <code>my_vault_file</code>, use the create action:</p>
<div class="codehilite"><pre><span></span>ansible-vault create my_vault_file
</pre></div>


<h2 id="how-to-edit-the-vault-file">How to edit the vault file?<a class="headerlink" href="#how-to-edit-the-vault-file" title="Permanent link">&para;</a></h2>
<p>To edit the contents of the vualt file, use the edit action</p>
<div class="codehilite"><pre><span></span>EDITOR=&quot;vim&quot; ansible-vault edit my_vault_file
</pre></div>


<h2 id="how-to-use-the-vault-file">How to use the vault file?<a class="headerlink" href="#how-to-use-the-vault-file" title="Permanent link">&para;</a></h2>
<p>Vault files are used by ansible in the process of running playbooks.
The user can provide Ansible with the vault password either on the
command line (via an interactive prompt), or the user can put the
vault password into a file, and point Ansible to the vault password
file when it is run.</p>
<p>We do that latter, putting the vault password in the file <code>.vault_secret</code>.</p>
<p>To tell ansible wehre to find the vault password, we set <code>vault_password_file</code>
in the configuration file. In both configuration files, we have:</p>
<div class="codehilite"><pre><span></span>vault_password_file = .vault_secret
</pre></div>


<p>Put your password into the file <code>.vault_secret</code> and use this
configuration file (by pointing to it with the <code>ANSIBLE_CONFIG</code>
environment variable when running ansible).</p>
<h2 id="adding-new-secret-variables">Adding new secret variables<a class="headerlink" href="#adding-new-secret-variables" title="Permanent link">&para;</a></h2>
<p>Suppose we have a role that utilizes a variable that is sensitive
and should remain secret. To do this, we set up a series of
variable definitions that allow the secret defined in the vault
to be used for different roles.</p>
<p>Suppose we have a role that uses an API key in a command. The role
utilizes a variable <code>{{ api_key }}</code> like so:</p>
<p><code>roles/my-role/tasks/main.yml</code>:</p>
<div class="codehilite"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">A simple example task using a secret variable</span>
  <span class="nt">command</span><span class="p">:</span> <span class="s">&quot;python</span><span class="nv"> </span><span class="s">script.py</span><span class="nv"> </span><span class="s">--api-key={{</span><span class="nv"> </span><span class="s">api_key</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>


<p>If the variable <code>api_key</code> is defined in the task default variable 
values, this command will be run but with an invalid API key.
If the above command should <em>only</em> be run with a valid API key,
you can leave <code>api_key</code> out of the default variable values.</p>
<p>Here is what that would look like, if you defined the API key 
to be an empty string by default:</p>
<p><code>roles/my-role/defaults/main.yml</code>:</p>
<div class="codehilite"><pre><span></span><span class="nn">---</span>
<span class="nt">api_key</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
</pre></div>


<p>To set the real <code>api_key</code> value, override the default variable
value in the playbook(s) that run that role. For example, if
the role <code>my-role</code> is called from a playbook <code>main.yml</code>,</p>
<p><code>main.yml</code>:</p>
<div class="codehilite"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run my-role</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-role</span>
      <span class="nt">api_key</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">charlesreid1_api_key</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>


<p>This specifies that the <code>api_key</code> variable should be set to the 
value of the variable <code>charlesreid1_api_key</code>.</p>
<p>The prefix <code>charlesreid1</code> indicates a site-specific variable setting.
Those variables are contained in <code>group_vars/all/main.yml</code>.
The variable is defined there, but it is also defining the variable
to be set to another variable value:</p>
<p><code>group_vars/all/main.yml</code>:</p>
<div class="codehilite"><pre><span></span><span class="nn">---</span>
<span class="nt">charlesreid1_api_key</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vault_api_key</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>


<p>The last step is to define the variable in the vault.
This is where we use the <code>ansible-vault</code> command to edit
the vault file:</p>
<div class="codehilite"><pre><span></span>ANSIBLE_CONFIG=&quot;my_config.cfg&quot; ansible-vault edit group_vars/all/vault
</pre></div>


<p>This is where you put the real API key:</p>
<p><code>group_vars/all/vault</code>:</p>
<div class="codehilite"><pre><span></span><span class="nn">---</span>
<span class="nt">vault_api_key</span><span class="p">:</span> <span class="s">&quot;ABCXYZ123456&quot;</span>
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../ansible_playbooks/" title="Ansible Playbooks" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Ansible Playbooks
              </span>
            </div>
          </a>
        
        
          <a href="../ansible_cowsay/" title="Ansible Cowsay" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Ansible Cowsay
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 <a href="https://charlesreid1.com">Charles Reid</a>, released under the <a href="https://opensource.org/licenses/MIT">MIT license</a>
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.e72fd936.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:".."}})</script>
      
        <script src="../search/main.js"></script>
      
    
    
      
    
  </body>
</html>